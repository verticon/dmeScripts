<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>DME Scripts Demo</title>
    </h:head>
    <h:body> 
    	<h:outputStylesheet library="default" name="css/style.css"  />	<!-- Place in body to insure that my styles load after PrimeFaces' -->

		<h3 class="title">DME Scripts Order</h3>
		<h:outputText value="&#160;" />
			
    	<h:form id="orderProduct" styleClass="demo">

	    	<h:panelGroup id="selectedProduct">
            	<h:outputText value="#{orderController1.selectedProduct}" />
        	    <h:commandButton value="Order" rendered="#{orderController1.selectedProduct != null}" styleClass="demo">
					<f:ajax listener="#{orderController1.orderItem}" render="orderStatus" />
        	    </h:commandButton>
          		<h:outputText id="orderStatus" value="#{orderController1.orderStatus}" rendered="#{orderController1.selectedProduct != null}" />
		    </h:panelGroup>

			<p:panelGrid>
				<p:row>
					<p:column style="vertical-align: top;">
							<p:tree id="categories" widgetVar="categoryTree" value="#{orderController1.categories}" var="node" orientation="horizontal" selectionMode="single" >
								<p:treeNode type="type">
									<h:outputText value="#{node}" />
								</p:treeNode>
								<p:treeNode type="category">
									<h:outputText value="#{node}" />
								</p:treeNode>
								<p:treeNode type="manufacturer">
									<h:outputText value="#{node}" />
								</p:treeNode>
								<p:treeNode styleClass="hidden">
									<h:outputText value="#{node}" style="color: yellow;"/>
								</p:treeNode>
	
								<p:ajax event="expand" listener="#{orderController1.onCategoryNodeExpanded}" oncomplete="closeOthers(this, PF('categoryTree'))"/>
								<p:ajax event="select" listener="#{orderController1.onProductNodeSelected}" update="orderProduct:selectedProduct" />
							</p:tree>

							<p:contextMenu for="categories"/>
							<p:contextMenu for="categories" nodeType="category">
								<p:menuitem value="Order" actionListener="#{orderController1.orderItem}" update="orderProduct:selectedProduct" />
							</p:contextMenu>
							<p:contextMenu for="categories" nodeType="manufacturer">
								<p:menuitem value="Favorite" actionListener="#{orderController1.saveFovorite}" />
							</p:contextMenu>
							<p:contextMenu for="categories" nodeType="item">
								<p:menuitem value="Order" actionListener="#{orderController1.orderItem}" update="orderProduct:selectedProduct" />
								<p:menuitem value="Favorite" actionListener="#{orderController1.saveFovorite}" />
							</p:contextMenu>

							<h:outputScript>
							
							//<![CDATA[
							
							function closeOthers(current, widget) {
							
							    var dataRowkey = $.urlParam(decodeURIComponent(current.data),current.source+"_expandNode");
				
							    //For a vertical tree:      
							    //var selector = "li[data-rowkey='"+dataRowkey+"']";
							    //$(widget.jq).find(selector).siblings().find("span[aria-expanded='true']").siblings(".ui-tree-toggler").trigger("click");
				
							    //For a horizontal tree
							    var selector = "td[data-rowkey='" + dataRowkey + "']";
							    $(widget.jq).find(selector).parent().parent().parent().siblings().find(".ui-icon-minus").trigger("click");
							}			
							
							$.urlParam = function (query, name) {
								var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(query);
							    return (results !== null) ? results[1] || 0 : false;
							}
							
							//]]>
				
							</h:outputScript>
					</p:column>
					<p:column>
			        	<p:panel styleClass="productItems">
							<p:tree value="#{orderController1.items}" var="node" dynamic="true" orientation="horizontal" selectionMode="single" >
								<p:treeNode type="item">
			        				<p:panelGrid>
			        					<p:row>
			        						<p:column width="100">
												<h:graphicImage url="#{node.imageUrl}"/>
			        						</p:column>
			        					</p:row>
			        					<p:row>
			        						<p:column width="100">
												<h:outputText value="#{node}" />
			        						</p:column>
			        					</p:row>
						        	</p:panelGrid>
								</p:treeNode>
								<p:treeNode>
									<h:outputText value="#{node}" />
								</p:treeNode>
	
								<p:ajax event="select" listener="#{orderController1.onProductNodeSelected}" update="orderProduct:selectedProduct" />
							</p:tree>
						</p:panel>
					</p:column>
				</p:row>

			</p:panelGrid>

    	</h:form>

	</h:body>
</html>
